{"remainingRequest":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\tslint-loader\\index.js!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\src\\main\\webapp\\app\\entities\\respuesta\\respuesta-update.component.ts","dependencies":[{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\src\\main\\webapp\\app\\entities\\respuesta\\respuesta-update.component.ts","mtime":1572998499064},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1564750574678},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1564750573341},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\ts-loader\\index.js","mtime":1519365772000},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\angular-router-loader\\src\\index.js","mtime":1512749902000},{"path":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\tslint-loader\\index.js","mtime":1519899048000}],"contextDependencies":[],"result":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\n/**\r\n * Created by sneiraillanes on 22-04-2019.\r\n */\r\nvar core_1 = require(\"@angular/core\");\r\nvar router_1 = require(\"@angular/router\");\r\nvar respuesta_model_1 = require(\"../../shared/model/respuesta.model\");\r\nvar plantilla_model_1 = require(\"../../shared/model/plantilla.model\");\r\nvar documento_model_1 = require(\"../../shared/model/documento.model\");\r\nvar respuesta_service_1 = require(\"./respuesta.service\");\r\nvar documento_service_1 = require(\"../documento/documento.service\");\r\nvar plantilla_service_1 = require(\"../plantilla/plantilla.service\");\r\nvar providencia_model_1 = require(\"../../shared/model/providencia.model\");\r\nvar providencia_service_1 = require(\"../providencia/providencia.service\");\r\nvar ng_jhipster_1 = require(\"ng-jhipster\");\r\nvar RespuestaUpdateComponent = /** @class */ (function () {\r\n    function RespuestaUpdateComponent(respuestaService, documentoService, plantillaService, activatedRoute, providenciaService, jhiAlertService) {\r\n        this.respuestaService = respuestaService;\r\n        this.documentoService = documentoService;\r\n        this.plantillaService = plantillaService;\r\n        this.activatedRoute = activatedRoute;\r\n        this.providenciaService = providenciaService;\r\n        this.jhiAlertService = jhiAlertService;\r\n        this.resp = new core_1.EventEmitter();\r\n        this._respuesta = new respuesta_model_1.Respuesta();\r\n        this.documentos = [];\r\n        this.showEditorTemplate = false;\r\n    }\r\n    RespuestaUpdateComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.isSaving = false;\r\n        this.plantillaUtilizada = new plantilla_model_1.Plantilla(null, null, '', null, null);\r\n        // this.onSelectPlantilla(2651);\r\n        this.respuestaService.getByProvidencia(this.providencia).subscribe(function (req) {\r\n            if (req.body.id !== null) {\r\n                _this._respuesta = req.body;\r\n                _this.comentario = _this._respuesta.comentario;\r\n                _this.adjuntos = _this._respuesta.adjuntos;\r\n                _this.documentos = _this._respuesta.documentos;\r\n                _this.resp.emit(_this.respuesta);\r\n            }\r\n        }, function (req) { return _this.onError(req.status); });\r\n        this.providenciaService.getPlantillasEnabled(this.providencia).subscribe(function (req) {\r\n            _this.plantillas = req.body;\r\n        }, function (req) { return _this.onError(req.status); });\r\n    };\r\n    RespuestaUpdateComponent.prototype.previousState = function () {\r\n        window.history.back();\r\n    };\r\n    RespuestaUpdateComponent.prototype.save = function (guardar) {\r\n        this.isSaving = true;\r\n        this._respuesta.adjuntos = this.adjuntos;\r\n        this._respuesta.documentos = this.documentos;\r\n        this._respuesta.comentario = this.comentario;\r\n        this._respuesta.guardada = guardar;\r\n        this._respuesta.providencia = this.providencia;\r\n        this._respuesta.estadoProvidencia = this.providencia.estadoActual;\r\n        if (this.respuesta.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.respuestaService.update(this.respuesta));\r\n        }\r\n        else {\r\n            this.subscribeToSaveResponse(this.respuestaService.create(this.respuesta));\r\n        }\r\n    };\r\n    RespuestaUpdateComponent.prototype.subscribeToSaveResponse = function (result) {\r\n        var _this = this;\r\n        result.subscribe(function (res) {\r\n            _this.resp.emit(res.body);\r\n            _this.onSaveSuccess();\r\n        }, function (res) { return _this.onSaveError(); });\r\n        this.isSaving = false;\r\n    };\r\n    RespuestaUpdateComponent.prototype.onSaveSuccess = function () {\r\n        this.isSaving = false;\r\n        this.ngOnInit();\r\n    };\r\n    RespuestaUpdateComponent.prototype.onSaveError = function () {\r\n        this.isSaving = false;\r\n    };\r\n    Object.defineProperty(RespuestaUpdateComponent.prototype, \"respuesta\", {\r\n        get: function () {\r\n            return this._respuesta;\r\n        },\r\n        set: function (respuesta) {\r\n            this._respuesta = respuesta;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RespuestaUpdateComponent.prototype.getUploadedAdjuntos = function ($event) {\r\n        var _this = this;\r\n        this.adjuntos = $event;\r\n        setTimeout(function () {\r\n            _this.save(false);\r\n        }, 300);\r\n    };\r\n    RespuestaUpdateComponent.prototype.getNotDeletedDocuments = function ($event) {\r\n        var _this = this;\r\n        this.documentos = $event;\r\n        setTimeout(function () {\r\n            _this.save(false);\r\n        }, 300);\r\n    };\r\n    RespuestaUpdateComponent.prototype.onSelectPlantilla = function (idPlantilla) {\r\n        var _this = this;\r\n        if (idPlantilla !== 'Seleccionar') {\r\n            this.plantillaService.find(parseInt(idPlantilla, 10)).subscribe(function (plantilla) {\r\n                _this.plantillaUtilizada = plantilla.body;\r\n                _this.showEditorTemplate = true;\r\n            });\r\n        }\r\n        else {\r\n            this.plantillaUtilizada = new plantilla_model_1.Plantilla(null, null, '', null, null);\r\n            this.showEditorTemplate = false;\r\n        }\r\n    };\r\n    RespuestaUpdateComponent.prototype.onAttachPlantilla = function () {\r\n        var _this = this;\r\n        this.isSaving = true;\r\n        var documento = new documento_model_1.Documento();\r\n        documento.contenido = this.plantillaUtilizada.contenido;\r\n        documento.providenciaId = this.providencia.id;\r\n        documento.archivoNombre = this.plantillaUtilizada.nombre;\r\n        documento.tipoPlantilla = this.plantillaUtilizada.tipo;\r\n        this.documentoService.create(documento).subscribe(function (res) {\r\n            _this.documentos.push(res.body);\r\n            _this.save(false);\r\n        }, function (error) {\r\n            console.log(error);\r\n            _this.isSaving = false;\r\n        });\r\n    };\r\n    RespuestaUpdateComponent.prototype.onError = function (status) {\r\n        console.log(status);\r\n        if (status === 404) {\r\n            this.jhiAlertService.error('No existen respuestas asociadas a la providencia.', null, null);\r\n        }\r\n    };\r\n    tslib_1.__decorate([\r\n        core_1.Input(),\r\n        tslib_1.__metadata(\"design:type\", typeof (_a = typeof providencia_model_1.IProvidencia !== \"undefined\" && providencia_model_1.IProvidencia) === \"function\" && _a || Object)\r\n    ], RespuestaUpdateComponent.prototype, \"providencia\", void 0);\r\n    tslib_1.__decorate([\r\n        core_1.Output(),\r\n        tslib_1.__metadata(\"design:type\", typeof (_b = typeof core_1.EventEmitter !== \"undefined\" && core_1.EventEmitter) === \"function\" && _b || Object)\r\n    ], RespuestaUpdateComponent.prototype, \"resp\", void 0);\r\n    RespuestaUpdateComponent = tslib_1.__decorate([\r\n        core_1.Component({\r\n            selector: 'jhi-respuesta-update',\r\n            templateUrl: './respuesta-update.component.html'\r\n        }),\r\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_c = typeof respuesta_service_1.RespuestaService !== \"undefined\" && respuesta_service_1.RespuestaService) === \"function\" && _c || Object, typeof (_d = typeof documento_service_1.DocumentoService !== \"undefined\" && documento_service_1.DocumentoService) === \"function\" && _d || Object, typeof (_e = typeof plantilla_service_1.PlantillaService !== \"undefined\" && plantilla_service_1.PlantillaService) === \"function\" && _e || Object, typeof (_f = typeof router_1.ActivatedRoute !== \"undefined\" && router_1.ActivatedRoute) === \"function\" && _f || Object, typeof (_g = typeof providencia_service_1.ProvidenciaService !== \"undefined\" && providencia_service_1.ProvidenciaService) === \"function\" && _g || Object, typeof (_h = typeof ng_jhipster_1.JhiAlertService !== \"undefined\" && ng_jhipster_1.JhiAlertService) === \"function\" && _h || Object])\r\n    ], RespuestaUpdateComponent);\r\n    return RespuestaUpdateComponent;\r\n    var _a, _b, _c, _d, _e, _f, _g, _h;\r\n}());\r\nexports.RespuestaUpdateComponent = RespuestaUpdateComponent;\r\n",{"version":3,"file":"C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\src\\main\\webapp\\app\\entities\\respuesta\\respuesta-update.component.ts","sourceRoot":"","sources":["C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\node_modules\\tslint-loader\\index.js!C:\\Users\\rbarrera\\Documents\\Proyectos\\ifyum\\app\\src\\main\\webapp\\app\\entities\\respuesta\\respuesta-update.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Created by sneiraillanes on 22-04-2019.\r\n */\r\nimport {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { HttpResponse, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, from, of } from 'rxjs';\r\nimport {IRespuesta, Respuesta} from '../../shared/model/respuesta.model';\r\nimport {IPlantilla, Plantilla} from '../../shared/model/plantilla.model';\r\nimport {IAdjunto} from '../../shared/model/adjunto.model';\r\nimport {Documento, IDocumento} from '../../shared/model/documento.model';\r\nimport {RespuestaService} from './respuesta.service';\r\nimport {DocumentoService} from '../documento/documento.service';\r\nimport {PlantillaService} from '../plantilla/plantilla.service';\r\nimport {IProvidencia} from '../../shared/model/providencia.model';\r\nimport {ProvidenciaService} from '../providencia/providencia.service';\r\nimport {JhiAlertService} from 'ng-jhipster';\r\n\r\n@Component({\r\n    selector: 'jhi-respuesta-update',\r\n    templateUrl: './respuesta-update.component.html'\r\n})\r\nexport class RespuestaUpdateComponent implements OnInit {\r\n    @Input() providencia: IProvidencia;\r\n    @Output() resp: EventEmitter<any> = new EventEmitter();\r\n\r\n    private _respuesta: IRespuesta = new Respuesta();\r\n    comentario: string;\r\n    isSaving: boolean;\r\n    plantillaUtilizada: IPlantilla;\r\n    adjuntos: IAdjunto[];\r\n    documentos: IDocumento[] = [];\r\n    showEditorTemplate = false;\r\n    plantillas: IPlantilla[];\r\n\r\n    constructor(\r\n        private respuestaService: RespuestaService,\r\n        private documentoService: DocumentoService,\r\n        private plantillaService: PlantillaService,\r\n        private activatedRoute: ActivatedRoute,\r\n        private providenciaService: ProvidenciaService,\r\n        private jhiAlertService: JhiAlertService\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.isSaving = false;\r\n        this.plantillaUtilizada = new Plantilla(null, null, '', null, null);\r\n        // this.onSelectPlantilla(2651);\r\n        this.respuestaService.getByProvidencia(this.providencia).subscribe(\r\n            (req: HttpResponse<IRespuesta>) => {\r\n                if (req.body.id !== null) {\r\n                    this._respuesta = req.body;\r\n                    this.comentario = this._respuesta.comentario;\r\n                    this.adjuntos = this._respuesta.adjuntos;\r\n                    this.documentos = this._respuesta.documentos;\r\n                    this.resp.emit(this.respuesta);\r\n                }\r\n            },\r\n            (req: HttpErrorResponse) => this.onError(req.status)\r\n        );\r\n\r\n        this.providenciaService.getPlantillasEnabled(this.providencia).subscribe(\r\n            (req: HttpResponse<IPlantilla[]>) => {\r\n                this.plantillas = req.body;\r\n            },\r\n            (req: HttpErrorResponse) => this.onError(req.status)\r\n        );\r\n    }\r\n\r\n    previousState() {\r\n        window.history.back();\r\n    }\r\n\r\n    save(guardar: boolean) {\r\n        this.isSaving = true;\r\n        this._respuesta.adjuntos = this.adjuntos;\r\n        this._respuesta.documentos = this.documentos;\r\n        this._respuesta.comentario = this.comentario;\r\n        this._respuesta.guardada = guardar;\r\n        this._respuesta.providencia = this.providencia;\r\n        this._respuesta.estadoProvidencia = this.providencia.estadoActual;\r\n        if (this.respuesta.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.respuestaService.update(this.respuesta));\r\n        } else {\r\n            this.subscribeToSaveResponse(this.respuestaService.create(this.respuesta));\r\n        }\r\n    }\r\n\r\n    private subscribeToSaveResponse(result: Observable<HttpResponse<IRespuesta>>) {\r\n        result.subscribe(\r\n            (res: HttpResponse<IRespuesta>) => {\r\n                this.resp.emit(res.body);\r\n                this.onSaveSuccess();\r\n            },\r\n            (res: HttpErrorResponse) => this.onSaveError());\r\n        this.isSaving = false;\r\n    }\r\n\r\n    private onSaveSuccess() {\r\n        this.isSaving = false;\r\n        this.ngOnInit();\r\n    }\r\n\r\n    private onSaveError() {\r\n        this.isSaving = false;\r\n    }\r\n    get respuesta() {\r\n        return this._respuesta;\r\n    }\r\n\r\n    set respuesta(respuesta: IRespuesta) {\r\n        this._respuesta = respuesta;\r\n    }\r\n\r\n    getUploadedAdjuntos($event) {\r\n        this.adjuntos = $event;\r\n        setTimeout(() => {\r\n            this.save(false);\r\n        }, 300);\r\n    }\r\n\r\n    getNotDeletedDocuments($event) {\r\n        this.documentos = $event;\r\n        setTimeout(() => {\r\n            this.save(false);\r\n        }, 300);\r\n    }\r\n\r\n    onSelectPlantilla(idPlantilla: string) {\r\n        if (idPlantilla !== 'Seleccionar') {\r\n            this.plantillaService.find(parseInt(idPlantilla, 10)).subscribe(plantilla => {\r\n                this.plantillaUtilizada = plantilla.body;\r\n                this.showEditorTemplate = true;\r\n            });\r\n        } else {\r\n            this.plantillaUtilizada = new Plantilla(null, null, '', null, null);\r\n            this.showEditorTemplate = false;\r\n        }\r\n    }\r\n\r\n    onAttachPlantilla() {\r\n        this.isSaving = true;\r\n        const documento: IDocumento = new Documento();\r\n        documento.contenido = this.plantillaUtilizada.contenido;\r\n        documento.providenciaId = this.providencia.id;\r\n        documento.archivoNombre = this.plantillaUtilizada.nombre;\r\n        documento.tipoPlantilla = this.plantillaUtilizada.tipo;\r\n\r\n        this.documentoService.create(documento).subscribe(\r\n            (res: HttpResponse<IDocumento>) => {\r\n                this.documentos.push(res.body);\r\n                this.save(false);\r\n            },\r\n            (error: HttpErrorResponse) => {\r\n                console.log(error);\r\n                this.isSaving = false;\r\n            }\r\n        );\r\n    }\r\n\r\n    private onError(status: number) {\r\n        console.log(status);\r\n        if (status === 404) {\r\n            this.jhiAlertService.error('No existen respuestas asociadas a la providencia.', null, null);\r\n        }\r\n    }\r\n\r\n}\r\n"]}]}